{# --- Front Matter --- #}
---
title: Dosing Data Blog # Or your actual site title
layout: base.njk # Uses _includes/base.njk
permalink: / # Generates index.html at the root
---

{# This extends the base layout. The content below goes into the 'content' block defined in base.njk #}
{% extends "base.njk" %}

{# Import your post card macro, path relative to _includes #}
{% import "macros/post-card.njk" as cards %}

{# Define the content that goes into the 'content' block of base.njk #}
{% block content %}

  {# --- START: Calculate Hero Posts (Keep this part) --- #}
  {% set featured = collections.featuredPosts %}
  {% set centerPost = null %}
  {% for post in featured %}
    {% if post.data.featured_center === true %}
        {% set centerPost = post %}
    {% endif %}
  {% endfor %}
  {# --- END: Calculate Hero Posts --- #}


  {# --- START DEEP DEBUGGING OF FILTERING --- #}
  <div style="border: 3px solid purple; padding: 10px; margin: 15px 0; font-family: monospace; background-color: #fdf;">
      <h4 style="margin-top:0; color:purple;">DEEP DEBUG: Filtering Process</h4>

      <p><strong>Center Post Found:</strong> {% if centerPost %} YES (Title: {{ centerPost.data.title | default("T MISSING", true) }}) {% else %} NO {% endif %}</p>
      <hr>

      <p><strong>1. Initial 'featured' collection (Count: {{ featured | length }}):</strong></p>
      <ul>
      {% for p in featured %}
          <li>{{ loop.index }}: {{ p.data.title | default("T MISSING", true) }} (URL: {{ p.url | default("U MISSING", true) }}) - Center: {{ p.data.featured_center }}</li>
      {% else %}<li>EMPTY</li>{% endfor %}
      </ul>
      <hr>

      {% set potentialSidePosts = featured %}
      {% if centerPost %}
          <p><strong>2. Applying rejectattr('url', 'equalto', '{{ centerPost.url }}')</strong></p>
          {% set potentialSidePosts = featured | rejectattr("url", "equalto", centerPost.url) %}
      {% else %}
           <p><strong>2. No center post, potentialSidePosts = featured</strong></p>
      {% endif %}

      <p><strong>3. 'potentialSidePosts' AFTER rejectattr (Count: {{ potentialSidePosts | length }}):</strong></p>
      <ul>
      {% for p in potentialSidePosts %}
           <li>{{ loop.index }}: {{ p.data.title | default("T MISSING", true) }} (URL: {{ p.url | default("U MISSING", true) }}) - Center: {{ p.data.featured_center }}</li>
      {% else %}<li>EMPTY</li>{% endfor %}
      </ul>
      <hr>

      {% set sidePosts = potentialSidePosts | slice(0, 4) %}
      <p><strong>4. 'sidePosts' AFTER slice(0, 4) (Count: {{ sidePosts | length }}):</strong></p>
      <ul>
      {% for p in sidePosts %}
          <li>{{ loop.index }}: {{ p.data.title | default("T MISSING", true) }} (URL: {{ p.url | default("U MISSING", true) }}) - Center: {{ p.data.featured_center }}</li>
      {% else %}<li>EMPTY</li>{% endfor %}
      </ul>
      <hr>

       <p><strong>5. Attempting to loop over 'sidePosts' directly:</strong></p>
       {% set loopDidRun = false %}
       {% for p in sidePosts %}
           <p style="color: blue;">Looping... item {{ loop.index }} title: {{ p.data.title | default("T MISSING", true) }}</p>
           {% set loopDidRun = true %}
       {% else %}
           <p style="color: red; font-weight: bold;">Direct loop over 'sidePosts' executed {% raw %}{% else %}{% endraw %} block.</p>
       {% endfor %}
       {% if not loopDidRun and sidePosts.length > 0 %}
            <p style="color: red; font-weight: bold;">Direct loop over 'sidePosts' DID NOT RUN, and did not execute else block!</p>
       {% endif %}
       {% if loopDidRun %}
             <p style="color: green; font-weight: bold;">Direct loop over 'sidePosts' SUCCEEDED.</p>
       {% endif %}

  </div>
  {# --- END DEEP DEBUGGING OF FILTERING --- #}

{% endblock %}