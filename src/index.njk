{# --- Front Matter --- #}
---
title: Dosing Data Blog # Or your actual site title
layout: base.njk # Uses _includes/base.njk
permalink: / # Generates index.html at the root
---

{# This extends the base layout. The content below goes into the 'content' block defined in base.njk #}
{% extends "base.njk" %}

{# Import your post card macro, path relative to _includes #}
{% import "macros/post-card.njk" as cards %}

{# Define the content that goes into the 'content' block of base.njk #}
{% block content %}

  {# --- START: Calculate Hero Posts --- #}
  {% set featured = collections.featuredPosts %}
  {% set centerPost = null %}
  {% for post in featured %}
    {% if post.data.featured_center === true %}
        {% set centerPost = post %}
    {% endif %}
  {% endfor %}
  {# --- END: Calculate Hero Posts --- #}

  {# --- START FINAL MANUAL FILTER ATTEMPT with URL DEBUG --- #}
  <div style="border: 3px solid darkred; padding: 10px; margin: 15px 0; font-family: monospace; background-color: #fdf;">
      <h4 style="margin-top:0; color:darkred;">FINAL FILTER DEBUG</h4>

      {# Initialize an empty list string - Hacky workaround #}
      {% set sidePostData = [] %}
      {% set centerUrl = "" %}
      {% if centerPost %}{% set centerUrl = centerPost.url %}{% endif %}

      <p>Center URL to exclude: '{{ centerUrl }}' (Length: {{ centerUrl | length }})</p>
      <p>Looping through {{ featured | length }} featured posts:</p>
      <ol>
      {% for p in featured %}
          {% set currentUrl = p.url %}
          <li>
              Post: {{ p.data.title }} | URL: '{{ currentUrl }}' (Length: {{ currentUrl | length }}) | Compare != centerUrl? {% if currentUrl != centerUrl %}TRUE{% else %}FALSE{% endif %}
              {% if currentUrl != centerUrl %}
                  <span style="color:green;">-> Adding post object to sidePostData</span>
                  {# Use list 'addition' that should work #}
                  {% set sidePostData = (sidePostData.push(p), sidePostData) %}
                  {# If push doesn't work, this variable remains [] #}
              {% else %}
                  <span style="color:red;">-> SKIPPING (Matches Center URL)</span>
              {% endif %}
          </li>
      {% endfor %}
      </ol>
      <hr>
       {# Set sidePosts directly from the manually built list #}
       {% set sidePosts = sidePostData %}
       <p><strong>Final sidePosts count (from manually built list): {{ sidePosts | length }}</strong></p>
        <p><strong>Attempting direct loop over final sidePosts:</strong></p>
        {% set loopDidRun = false %}
        {% for item in sidePosts %}
            <p style="color:blue">Looping item: {{ item.data.title }}</p>
            {% set loopDidRun = true %}
        {% else %}
             <p style="color:red; font-weight: bold;">Loop over final sidePosts FAILED ({% raw %}{% else %}{% endraw %} block).</p>
        {% endfor %}
        {% if not loopDidRun and sidePosts | length > 0 %}
             <p style="color: red; font-weight: bold;">Loop over 'sidePosts' DID NOT RUN, and did not execute else block!</p>
        {% endif %}
        {% if loopDidRun %}
              <p style="color: green; font-weight: bold;">Direct loop over 'sidePosts' SUCCEEDED.</p>
        {% endif %}
  </div>
  {# --- END FINAL MANUAL FILTER ATTEMPT --- #}

  {# --- Temporarily disable rendering to focus on debug --- #}
  <p style="text-align: center; color: gray;">(Rendering temporarily disabled)</p>

{% endblock %}