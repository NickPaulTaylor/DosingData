{# src/index.njk #}
{% extends "base.njk" %} {# Assumes base layout is at _includes/base.njk #}

{# Set the title for this page #}
{% set title = "Home" %}

{% block content %}
<div class="container">

  {# ========================================================== #}
  {# START: Inserted Logic from Step 2                        #}
  {# ========================================================== #}

  {# Fetch all posts, newest first #}
  {% set posts = collections.post | reverse %} {# Assuming posts tagged 'post'. Adjust if needed. #}

  {# Find the featured post #}
  {% set featuredPost = null %}
  {% for post in posts %}
    {% if post.data.featured %}
      {% set featuredPost = post %}
    {% endif %}
  {% endfor %}

  {# Optional: If no post is specifically marked as featured, default to the latest? #}
  {# {% if not featuredPost and posts | length > 0 %}
    {% set featuredPost = posts[0] %}
  {% endif %} #}

  {# Get posts for the hero section sides (excluding the featured one) #}
  {% set heroSidePosts = [] %}
  {% set postsForHeroSides = 4 %} {# We need 4 side posts #}
  {% if featuredPost %} {# Only gather side posts if a featured one exists #}
      {% for post in posts %}
        {% if post.url != featuredPost.url and heroSidePosts | length < postsForHeroSides %}
          {% set heroSidePosts = (heroSidePosts.push(post), heroSidePosts) %}
        {% endif %}
      {% endfor %}
  {% endif %}

  {# Separate the posts for the hero section from the rest #}
  {% set heroPostUrls = [] %}
  {% if featuredPost %}
      {# Add featured post URL #}
      {% set heroPostUrls = (heroPostUrls.push(featuredPost.url), heroPostUrls) %}
      {# Add side post URLs #}
      {% for post in heroSidePosts %}
        {% set heroPostUrls = (heroPostUrls.push(post.url), heroPostUrls) %}
      {% endfor %}
  {% endif %}

  {# Get remaining posts by filtering out hero posts #}
  {% set remainingPosts = [] %}
  {% for post in posts %}
    {% if post.url not in heroPostUrls %}
      {% set remainingPosts = (remainingPosts.push(post), remainingPosts) %}
    {% endif %}
  {% endfor %}

  {# ========================================================== #}
  {# END: Inserted Logic from Step 2                          #}
  {# ========================================================== #}


  {# ========================================================== #}
  {# START: Inserted Hero HTML Structure from Step 2          #}
  {#         (Adapted to use your post-card.njk partial)      #}
  {# ========================================================== #}

  {# --- HERO SECTION --- #}
  {# Only display hero section if we have a featured post and enough side posts #}
  {% if featuredPost and heroSidePosts | length == 4 %}
  <section class="hero-layout">
    {# --- Left Side --- #}
    <div class="hero-layout__left">
      {# Display first 2 side posts #}
      {% for post in heroSidePosts | slice(0, 2) %}
        <article class="hero-post hero-post--small">
          {# Use your partial here #}
          {% include "partials/post-card.njk" with { post: post, isSmallHero: true } %} {# Pass optional flag if needed #}
        </article>
      {% endfor %}
    </div>

    {# --- Center --- #}
    <div class="hero-layout__center">
      {# Display the featured post #}
      <article class="hero-post hero-post--large">
        {# Use your partial here #}
        {% include "partials/post-card.njk" with { post: featuredPost, isLargeHero: true } %} {# Pass optional flag if needed #}
      </article>
    </div>

    {# --- Right Side --- #}
    <div class="hero-layout__right">
      {# Display next 2 side posts #}
      {% for post in heroSidePosts | slice(2, 4) %}
        <article class="hero-post hero-post--small">
          {# Use your partial here #}
          {% include "partials/post-card.njk" with { post: post, isSmallHero: true } %} {# Pass optional flag if needed #}
        </article>
      {% endfor %}
    </div>
  </section> {# End hero-layout #}

  {# --- HORIZONTAL SEPARATOR --- #}
  <hr class="hero-separator">

  {% elif featuredPost %}
    {# Fallback: What if you have a featured post but NOT 4 side posts? #}
    {# Option 1: Display featured post prominently anyway, maybe above the grid #}
    <section class="featured-single">
       <article class="hero-post hero-post--large">
          {% include "partials/post-card.njk" with { post: featuredPost, isLargeHero: true } %}
       </article>
    </section>
    <hr class="hero-separator">
    {# Option 2: Don't show hero section at all - the 'remaining posts' grid will just show below #}

  {% endif %} {# End check for featuredPost #}

  {# ========================================================== #}
  {# END: Inserted Hero HTML Structure                        #}
  {# ========================================================== #}


  {# ========================================================== #}
  {# START: Remaining Posts Grid (Adapted from your code)     #}
  {# ========================================================== #}

  {# --- REMAINING POSTS GRID --- #}
  <section class="post-grid"> {# Using <section> for better semantics than <div> #}
    {# Loop through the remaining posts #}
    {%- for post in remainingPosts -%}
      {# Use the same partial for consistency. Assumes partial wraps in <article> or similar #}
      {% include "partials/post-card.njk" with { post: post } %}
    {%- else -%}
      {# Optional: Message if there are no posts at all (after filtering hero) #}
      {% if not featuredPost %} {# Only show 'No posts' if there wasn't even a featured one #}
         <p>No posts found.</p>
      {% endif %}
    {%- endfor -%}
  </section> {# End post-grid #}

  {# ========================================================== #}
  {# END: Remaining Posts Grid                              #}
  {# ========================================================== #}

</div> {# End container #}
{% endblock %}